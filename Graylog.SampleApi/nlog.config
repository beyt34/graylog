<?xml version="1.0" encoding="utf-8"?>
<nlog xmlns="http://www.nlog-project.org/schemas/NLog.xsd"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://www.nlog-project.org/schemas/NLog.xsd NLog.xsd"
      autoReload="true"
      throwExceptions="false"
      internalLogToConsole="false"
      internalLogLevel="Off"
      internalLogFile="${basedir}/Log/nlog-internal.log">

    <variable name="methodInfo"
              value="${callsite:className=true:includeNamespace=false:fileName=true:includeSourcePath=false:methodName=true:cleanNamesOfAnonymousDelegates=true:cleanNamesOfAsyncContinuations=true}" />
    <variable name="layout"
              value="${longdate}|${pad:padding=4:inner=${threadid}}|${pad:padding=-5:inner=${uppercase:${level}}}|${mdc:item=RequestGuid}|${logger}|${message}${onexception:inner=${newline}${exception:format=tostring}}" />
    <variable name="logPath"
              value="${basedir}/Log" />

    <targets>
        <target name="AsyncWrapper"
                xsi:type="AsyncWrapper"
                overflowAction="Grow"
                queueLimit="50000"
                batchSize="500"
                timeToSleepBetweenBatches="0">
            <target name="file"
                    xsi:type="File"
                    encoding="utf-8"
                    keepFileOpen="true"
                    openFileCacheTimeout="30"
                    maxArchiveFiles="0"
                    archiveFileName="${logPath}/${shortdate}/${date:format=HHmm}.{#}.log"
                    archiveNumbering="Sequence"
                    archiveAboveSize="10485760"
                    fileName="${logPath}/${shortdate}.log"
                    layout="${layout}" />
        </target>
    </targets>

    <rules>
        <logger name="Microsoft.AspNetCore.Server.Kestrel.*" minLevel="Trace" final="true" writeTo="" />
        <logger name="Microsoft.AspNetCore.Hosting.*" maxLevel="Info" final="true" writeTo="AsyncWrapper" />
        <logger name="Microsoft.AspNetCore.Mvc.*" maxLevel="Info" final="true" writeTo="AsyncWrapper" />
        <logger name="Microsoft.*" minLevel="Trace" final="true" writeTo="" />
        <logger name="NHibernate.SQL" level="Debug" final="true" writeTo="AsyncWrapper" />
        <logger name="NHibernate.*" levels="Debug, Info, Trace" final="true" />
        <logger name="NHibernate.Caches.*" level="Warn" final="true" />
        <logger name="NHibernate.Impl.SessionFactoryObjectFactory" level="Warn" final="true" />
        <logger name="*" minlevel="Debug" writeTo="AsyncWrapper" />
    </rules>
</nlog>
